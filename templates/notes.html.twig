{# templates/notes.html.twig #}
{% extends 'base.html.twig' %}

{% block body %}
<div id="topBar" class="p-3 mb-2 bg-primary">
    <div id="topBarLoadingSpinner" style="visibility: hidden;" class="spinner-border spinner-border-sm text-dark m-0" role="status"></div>
</div>
<div id="main" class="row container-fluid h-100 text-white">
    <div id="content" class="col-10 row">
        <div id="editor" class="col-md w-50 h-100">
            <textarea id="textEditor" class="rounded p-3 w-100 h-100 bg-dark text-white"></textarea>
        </div>
        <div id="preview" class="rounded p-3 mb-2 bg-dark col-md h-100 w-50" style="overflow-wrap:break-word; overflow:hidden;"></div>
    </div>
    <div id="sideBar" class="col row">
        <div class="col overflow-auto scrollbar scrollbar-primary" style="overflow-y: scroll; max-height:80vh;">
            {% for category in notes|keys %}
                <ul class="list-group mb-2" >
                    <a class="text-decoration-none rounded p-1 bg-primary text-white text-center" data-bs-toggle="collapse" href="#category_{{ loop.index0 }}" role="button" aria-expanded="false" aria-controls="category_{{ loop.index0 }}">
                        {{ category }}
                    </a>
                    <div class="collapse" id="category_{{ loop.index0 }}">
                        {% for j in 1..3 %}
                            <!--<a href='/notes/' ~ loop.parent.index0 ~ '/' ~ j class="list-group-item list-group-item-action text-white bg-dark">Seite {{ j }}</a>-->
                            <a href='#' class="list-group-item list-group-item-action text-white bg-dark">Seite {{ j }}</a>
                        {% endfor %}
                    </div>
                </ul>
            {% endfor %}
        </div>
        <div class="fixed bottom"> 
            <button type="button" class="btn btn-success m-1">Neu</button>
            <button type="button" class="btn btn-secondary m-1 disabled">Verschieben</button>
            <button type="button" class="btn btn-danger m-1 disabled">LÃ¶schen</button>
        </div>
    </div>
</div>
<script>
    // on page loaded
    $(document).ready(function() {
        // init editor
        // if editor changes, update preview
        let nextSync = 0;
        $("#textEditor").on("input", function () {
            $("#preview").html(marked.parse($("#textEditor").val()));
            if (nextSync < Date.now()) {
                nextSync = Date.now() + 1000;
                // make "topBarLoadingSpinner" visible
                $("#topBarLoadingSpinner").css("visibility", "visible");
                // create spinner-border text-primary and add to #topBar
                // remove spinner-border text-primary after 1 second
                //$("#topBar").html('<div class="spinner-border spinner-border-sm text-dark m-0" role="status"></div>');
                setTimeout(function() {
                    // hide "topBarLoadingSpinner"
                    $("#topBarLoadingSpinner").css("visibility", "hidden");
                }, 1000);
                $.ajax({
                    url: "/notes/sync",
                    type: "POST",
                    data: {
                        "content": $("#textEditor").val(),
                    }
                });
            }
        });

        // if a page is clicked, activate buttons
        $(".list-group-item").click(function() {
            $(".btn").removeClass("disabled");
            $(this).addClass("active");
            // set all other elements to inactive
            $(".list-group-item").not(this).removeClass("active");
        });

    });
</script>
<script src="notes.js" type="text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
{% endblock %}